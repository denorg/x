!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).i18nextLocizeBackend=e()}(function(){return function r(s,a,c){function u(t,e){if(!a[t]){if(!s[t]){var o="function"==typeof require&&require;if(!e&&o)return o(t,!0);if(l)return l(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var i=a[t]={exports:{}};s[t][0].call(i.exports,function(e){return u(s[t][1][e]||e)},i,i.exports,r,s,a,c)}return a[t].exports}for(var l="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(n,i,r){(function(e){var t,o;"function"==typeof fetch&&(void 0!==e&&e.fetch?t=e.fetch:"undefined"!=typeof window&&window.fetch&&(t=window.fetch)),void 0!==n&&((o=t||n("node-fetch")).default&&(o=o.default),r.default=o,i.exports=r.default)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"node-fetch":5}],2:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n,f=e("./utils.js"),p=(n=e("./request.js"))&&n.__esModule?n:{default:n};function i(t,e){var o,n=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)),n}function h(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?i(Object(o),!0).forEach(function(e){r(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var g;try{g="undefined"!=typeof window&&null!==window.localStorage;var a="notExistingLocizeProject";window.localStorage.setItem(a,"foo"),window.localStorage.removeItem(a)}catch(e){g=!1}var c=function(){function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=3<arguments.length?arguments[3]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.services=e,this.options=t,this.allOptions=o,this.type="backend",e&&e.projectId?this.init(null,e,o,t):this.init(e,t,o,n)}var e,t,o;return e=i,(t=[{key:"init",value:function(e,t,o,n){var i,r,s,a=this,c=1<arguments.length&&void 0!==t?t:{},u=2<arguments.length&&void 0!==o?o:{},l=3<arguments.length?n:void 0;this.services=e,this.options=(0,f.defaults)(c,this.options||{},{loadPath:"https://api.locize.app/{{projectId}}/{{version}}/{{lng}}/{{ns}}",privatePath:"https://api.locize.app/private/{{projectId}}/{{version}}/{{lng}}/{{ns}}",getLanguagesPath:"https://api.locize.app/languages/{{projectId}}",addPath:"https://api.locize.app/missing/{{projectId}}/{{version}}/{{lng}}/{{ns}}",updatePath:"https://api.locize.app/update/{{projectId}}/{{version}}/{{lng}}/{{ns}}",referenceLng:"en",crossDomain:!0,setContentTypeJSON:!1,version:"latest",private:!1,whitelistThreshold:.9,failLoadingOnEmptyJSON:!1,allowedAddOrUpdateHosts:["localhost"],onSaved:!1,reloadInterval:36e5,checkForProjectTimeout:3e3,storageExpiration:36e5}),this.allOptions=u,this.somethingLoaded=!1,this.isProjectNotExisting=!1,this.storage=(i=this.options.storageExpiration,r=function(){},s=function(){},g?(r=function(e){window.localStorage.setItem("notExistingLocizeProject_".concat(e),Date.now())},s=function(e){var t=window.localStorage.getItem("notExistingLocizeProject_".concat(e));return!(!t||Date.now()-t>i&&(window.localStorage.removeItem("notExistingLocizeProject_".concat(e)),1))}):"undefined"!=typeof document&&(r=function(e){var t=new Date;t.setTime(t.getTime()+i);var o="; expires=".concat(t.toGMTString()),n="notExistingLocizeProject_".concat(e);document.cookie="".concat(n,"=").concat(Date.now()).concat(o,";path=/")},s=function(e){for(var t="notExistingLocizeProject_".concat(e),o="".concat(t,"="),n=document.cookie.split(";"),i=0;i<n.length;i++){for(var r=n[i];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(o))return!0}return!1}),{setProjectNotExisting:r,isProjectNotExisting:s}),this.options.pull&&console.warn('The pull API was removed use "private: true" option instead: https://docs.locize.com/integration/api#fetch-private-namespace-resources');var d="undefined"!=typeof window&&window.location&&window.location.hostname;d?(this.isAddOrUpdateAllowed="function"==typeof this.options.allowedAddOrUpdateHosts?this.options.allowedAddOrUpdateHosts(d):-1<this.options.allowedAddOrUpdateHosts.indexOf(d),e&&e.logger&&(u.saveMissing||u.updateMissing)&&(this.isAddOrUpdateAllowed?"localhost"!==d&&e.logger.warn('locize-backend: you are using the save or update missings feature from this host "'.concat(d,'".\nMake sure you will not use it in production!\nhttps://docs.locize.com/guides-tips-and-tricks/going-production')):e.logger.warn("function"==typeof this.options.allowedAddOrUpdateHosts?'locize-backend: will not save or update missings because allowedAddOrUpdateHosts returned false for the host "'.concat(d,'".'):'locize-backend: will not save or update missings because the host "'.concat(d,'" was not in the list of allowedAddOrUpdateHosts: ').concat(this.options.allowedAddOrUpdateHosts.join(", ")," (matches need to be exact).")))):this.isAddOrUpdateAllowed=!0,"function"==typeof l&&this.getOptions(function(e,t){if(e)return l(e);a.options.referenceLng=c.referenceLng||t.referenceLng||a.options.referenceLng,l(null,t)}),this.queuedWrites={pending:{}},this.debouncedProcess=(0,f.debounce)(this.process,1e4),this.interval&&clearInterval(this.interval),this.options.reloadInterval&&(this.interval=setInterval(function(){return a.reload()},this.options.reloadInterval))}},{key:"reload",value:function(){var e,t,o,i=this,n=this.services,r=n.backendConnector,s=n.languageUtils,a=n.logger;r&&((e=r.language)&&"cimode"===e.toLowerCase()||(t=[],(o=function(e){s.toResolveHierarchy(e).forEach(function(e){t.indexOf(e)<0&&t.push(e)})})(e),this.allOptions.preload&&this.allOptions.preload.forEach(o),t.forEach(function(n){i.allOptions.ns.forEach(function(o){r.read(n,o,"read",null,null,function(e,t){e&&a.warn("loading namespace ".concat(o," for language ").concat(n," failed"),e),!e&&t&&a.log("loaded namespace ".concat(o," for language ").concat(n),t),r.loaded("".concat(n,"|").concat(o),e,t)})})})))}},{key:"getLanguages",value:function(n){var i=this,e=(0,f.isMissingOption)(this.options,["projectId"]);if(e)return n(new Error(e));var t=(0,f.interpolate)(this.options.getLanguagesPath,{projectId:this.options.projectId});if(!this.isProjectNotExisting&&this.storage.isProjectNotExisting(this.options.projectId)&&(this.isProjectNotExisting=!0),this.isProjectNotExisting)return n(new Error("locize project ".concat(this.options.projectId," does not exist!")));this.loadUrl({},t,function(e,t,o){if(!i.somethingLoaded&&o&&o.resourceNotExisting)return i.isProjectNotExisting=!0,i.storage.setProjectNotExisting(i.options.projectId),n(new Error("locize project ".concat(i.options.projectId," does not exist!")));i.somethingLoaded=!0,n(e,t)})}},{key:"getOptions",value:function(s){var a=this;this.getLanguages(function(e,n){if(e)return s(e);var t=Object.keys(n);if(!t.length)return s(new Error("was unable to load languages via API"));var o=t.reduce(function(e,t){return n[t].isReferenceLanguage&&(e=t),e},""),i=t.reduce(function(e,t){var o=n[t];return o.translated[a.options.version]&&o.translated[a.options.version]>=a.options.whitelistThreshold&&e.push(t),e},[]),r=t.reduce(function(e,t){return-1<t.indexOf("-")||e},!1);s(null,{fallbackLng:o,referenceLng:o,whitelist:i,load:r?"all":"languageOnly"})})}},{key:"checkIfProjectExists",value:function(t){var e=this,o=this.services.logger;this.somethingLoaded?t&&t(null):this.alreadyRequestedCheckIfProjectExists?setTimeout(function(){return e.checkIfProjectExists(t)},this.options.checkForProjectTimeout):(this.alreadyRequestedCheckIfProjectExists=!0,this.getLanguages(function(e){e&&e.message&&0<e.message.indexOf("does not exist")&&o&&o.error(e.message),t&&t(e)}))}},{key:"read",value:function(e,t,n){var o,i=this,r=(this.services||{logger:console}).logger,s={};if(this.options.private){var a=(0,f.isMissingOption)(this.options,["projectId","version","apiKey"]);if(a)return n(new Error(a),!1);o=(0,f.interpolate)(this.options.privatePath,{lng:e,ns:t,projectId:this.options.projectId,version:this.options.version}),s={authorize:!0}}else{var c=(0,f.isMissingOption)(this.options,["projectId","version"]);if(c)return n(new Error(c),!1);o=(0,f.interpolate)(this.options.loadPath,{lng:e,ns:t,projectId:this.options.projectId,version:this.options.version})}if(!this.isProjectNotExisting&&this.storage.isProjectNotExisting(this.options.projectId)&&(this.isProjectNotExisting=!0),this.isProjectNotExisting){var u=new Error("locize project ".concat(this.options.projectId," does not exist!"));return r&&r.error(u.message),void(n&&n(u))}this.loadUrl(s,o,function(e,t,o){i.somethingLoaded||(o&&o.resourceNotExisting?setTimeout(function(){return i.checkIfProjectExists()},i.options.checkForProjectTimeout):i.somethingLoaded=!0),n(e,t)})}},{key:"loadUrl",value:function(e,r,t,s){var a=this;e=(0,f.defaults)(e,this.options),"function"==typeof t&&(s=t,t=void 0),s=s||function(){},(0,p.default)(e,r,t,function(e,t){var o,n,i=t&&t.resourceNotExisting;if(t&&(408===t.status||400===t.status))return s("failed loading "+r,!0,{resourceNotExisting:i});if(t&&500<=t.status&&t.status<600)return s("failed loading "+r,!0,{resourceNotExisting:i});if(t&&400<=t.status&&t.status<500)return s("failed loading "+r,!1,{resourceNotExisting:i});if(e)return s(e,!1);try{o=JSON.parse(t.data)}catch(e){n="failed parsing "+r+" to json"}return n?s(n,!1):a.options.failLoadingOnEmptyJSON&&!Object.keys(o).length?s("loaded result empty for "+r,!1,{resourceNotExisting:i}):void s(null,o,{resourceNotExisting:i})})}},{key:"create",value:function(o,n,i,r,s,a){var c=this;s=s||function(){},this.checkIfProjectExists(function(e){if(e)return s(e);var t=(0,f.isMissingOption)(c.options,["projectId","version","apiKey","referenceLng"]);return t?s(new Error(t)):c.isAddOrUpdateAllowed?("string"==typeof o&&(o=[o]),o.filter(function(e){return e===c.options.referenceLng}).length<1&&c.services&&c.services.logger&&c.services.logger.warn('locize-backend: will not save missings because the reference language "'.concat(c.options.referenceLng,'" was not in the list of to save languages: ').concat(o.join(", ")," (open your site in the reference language to save missings).")),void o.forEach(function(e){e===c.options.referenceLng&&c.queue.call(c,c.options.referenceLng,n,i,r,s,a)})):s("host is not allowed to create key.")})}},{key:"update",value:function(o,n,i,r,s,a){var c=this;s=s||function(){},this.checkIfProjectExists(function(e){if(e)return s(e);var t=(0,f.isMissingOption)(c.options,["projectId","version","apiKey","referenceLng"]);return t?s(new Error(t)):c.isAddOrUpdateAllowed?("string"==typeof o&&(o=[o]),(a=a||{}).isUpdate=!0,void o.forEach(function(e){e===c.options.referenceLng&&c.queue.call(c,c.options.referenceLng,n,i,r,s,a)})):s("host is not allowed to update key.")})}},{key:"writePage",value:function(e,t,o,n){var i=(0,f.interpolate)(this.options.addPath,{lng:e,ns:t,projectId:this.options.projectId,version:this.options.version}),r=(0,f.interpolate)(this.options.updatePath,{lng:e,ns:t,projectId:this.options.projectId,version:this.options.version}),s=!1,a=!1,c={},u={};o.forEach(function(e){var t=e.options&&e.options.tDescription?{value:e.fallbackValue||"",context:{text:e.options.tDescription}}:e.fallbackValue||"";e.options&&e.options.isUpdate?(a=a||!0,u[e.key]=t):(s=s||!0,c[e.key]=t)});var l=0;s&&l++,a&&l++;function d(e){--l||n(e)}l||d(),s&&(0,p.default)(h(h({},{authorize:!0}),this.options),i,c,d),a&&(0,p.default)(h(h({},{authorize:!0}),this.options),r,u,d)}},{key:"write",value:function(i,r){var s,a=this;(0,f.getPath)(this.queuedWrites,["locks",i,r])||(s=(0,f.getPath)(this.queuedWrites,[i,r]),(0,f.setPath)(this.queuedWrites,[i,r],[]),s.length&&function(){(0,f.setPath)(a.queuedWrites,["locks",i,r],!0);function e(){(0,f.setPath)(a.queuedWrites,["locks",i,r],!1),s.forEach(function(e){e.callback&&e.callback()}),a.options.onSaved&&a.options.onSaved(i,r),a.debouncedProcess(i,r)}var t=s.length/1e3,o=0,n=s.splice(0,1e3);for(a.writePage(i,r,n,function(){t<=++o&&e()});1e3===n.length;)(n=s.splice(0,1e3)).length&&a.writePage(i,r,n,function(){t<=++o&&e()})}())}},{key:"process",value:function(){var o=this;Object.keys(this.queuedWrites).forEach(function(t){"locks"!==t&&Object.keys(o.queuedWrites[t]).forEach(function(e){o.queuedWrites[t][e].length&&o.write(t,e)})})}},{key:"queue",value:function(e,t,o,n,i,r){(0,f.pushPath)(this.queuedWrites,[e,t],{key:o,fallbackValue:n||"",callback:i,options:r}),this.debouncedProcess()}}])&&s(e.prototype,t),o&&s(e,o),i}();c.type="backend",o.default=c,t.exports=o.default},{"./request.js":3,"./utils.js":4}],3:[function(n,i,r){(function(e){"use strict";function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var a,c,u,t=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==s(e)&&"function"!=typeof e)return{default:e};var t=l();if(t&&t.has(e))return t.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e){var r;Object.prototype.hasOwnProperty.call(e,i)&&((r=n?Object.getOwnPropertyDescriptor(e,i):null)&&(r.get||r.set)?Object.defineProperty(o,i,r):o[i]=e[i])}o.default=e,t&&t.set(e,o);return o}(n("./getFetch.js"));function l(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}"function"==typeof fetch&&(void 0!==e&&e.fetch?a=e.fetch:"undefined"!=typeof window&&window.fetch&&(a=window.fetch)),"function"==typeof XMLHttpRequest&&(void 0!==e&&e.XMLHttpRequest?c=e.XMLHttpRequest:"undefined"!=typeof window&&window.XMLHttpRequest&&(c=window.XMLHttpRequest)),"function"==typeof ActiveXObject&&(void 0!==e&&e.ActiveXObject?u=e.ActiveXObject:"undefined"!=typeof window&&window.ActiveXObject&&(u=window.ActiveXObject)),!a&&t&&(a=t.default||t);function o(e,t,o,n){return"function"==typeof o&&(n=o,o=void 0),n=n||function(){},a?(i=e,s=n,void a(t,{method:(r=o)?"POST":"GET",body:r?JSON.stringify(r):void 0,headers:{Authorization:i.authorize&&i.apiKey?i.apiKey:void 0,"Content-Type":"application/json"}}).then(function(t){var o=t.headers&&"Error from cloudfront"===t.headers.get("x-cache");if(!t.ok)return s(t.statusText||"Error",{status:t.status,resourceNotExisting:o});t.text().then(function(e){s(null,{status:t.status,data:e,resourceNotExisting:o})}).catch(s)}).catch(s)):"function"==typeof XMLHttpRequest||"function"==typeof ActiveXObject?function(e,t,o,n){try{var i=c?new c:new u("MSXML2.XMLHTTP.3.0");i.open(o?"POST":"GET",t,1),e.crossDomain||i.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.authorize&&e.apiKey&&i.setRequestHeader("Authorization",e.apiKey),(o||e.setContentTypeJSON)&&i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=function(){var e="Error from cloudfront"===i.getResponseHeader("x-cache");3<i.readyState&&n(i.statusText,{status:i.status,data:i.responseText,resourceNotExisting:e})},i.send(JSON.stringify(o))}catch(e){console&&console.log(e)}}(e,t,o,n):void 0;var i,r,s}r.default=o,i.exports=r.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./getFetch.js":1}],4:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.defaults=function(o){return i.call(r.call(arguments,1),function(e){if(e)for(var t in e)void 0===o[t]&&(o[t]=e[t])}),o},o.debounce=function(n,i,r){var s;return function(){var e=this,t=arguments,o=r&&!s;clearTimeout(s),s=setTimeout(function(){s=null,r||n.apply(e,t)},i),o&&n.apply(e,t)}},o.setPath=function(e,t,o){var n=a(e,t,Object),i=n.obj,r=n.k;i[r]=o},o.pushPath=function(e,t,o,n){var i=a(e,t,Object),r=i.obj,s=i.k;r[s]=r[s]||[],n&&(r[s]=r[s].concat(o));n||r[s].push(o)},o.getPath=function(e,t){var o=a(e,t),n=o.obj,i=o.k;return n?n[i]:void 0},o.interpolate=function(e,t,o){var n,i;for(;n=s.exec(e);)"string"!=typeof(i=n[1].trim())&&(i=c(i)),i=(i=i||"").replace(/\$/g,"$$$$"),e=e.replace(n[0],t[i]||i),s.lastIndex=0;return e},o.isMissingOption=u,o.optionExist=function(e,t){return!u(e,t)};var n=[],i=n.forEach,r=n.slice;function a(e,t,o){function n(e){return e&&-1<e.indexOf("###")?e.replace(/###/g,"."):e}for(var i="string"!=typeof t?[].concat(t):t.split(".");1<i.length;){if(!e)return{};var r=n(i.shift());!e[r]&&o&&(e[r]=new o),e=e[r]}return e?{obj:e,k:n(i.shift())}:{}}var s=new RegExp("{{(.+?)}}","g");function c(e){return null==e?"":""+e}function u(n,e){return e.reduce(function(e,t){if(e)return e;if(n&&n[t]&&"string"==typeof n[t]&&!n[t].toLowerCase()!==t.toLowerCase())return!1;var o='i18next-locize-backend :: got "'.concat(n[t],'" in options for ').concat(t," which is invalid.");return console.warn(o),o},!1)}},{}],5:[function(e,t,o){(function(e){"use strict";e=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e)return e;throw new Error("unable to locate global object")}();t.exports=o=e.fetch,o.default=e.fetch.bind(e),o.Headers=e.Headers,o.Request=e.Request,o.Response=e.Response}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[2])(2)});