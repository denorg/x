!function(){"use strict";var i={data:{url:"",isLoading:!1,isLoaded:!1,hasError:!1,errorMessage:null,modelProp:null,refreshTimeInterval:null,intervalID:null,clickSelector:null,graphqlId:null,graphqlSrc:null,graphqlQuery:null,errorTextGraphQLErrors:"{count} GraphQL Errors occured. See console for full details.",vueInstance:null},onFetch:null,onError:null,fetchData:function(e,o){var r,a=this,l=null,n=null,t=app.activeController&&"Vue"===app.activeController.viewEngine;function s(){Object.assign(app.activeVueModel,{isLoading:a.isLoading,isLoaded:a.isLoaded,hasError:a.hasError,errorMessage:a.errorMessage})}a.isLoading||(a.isLoading=!0,a.isLoaded=!1,a.hasError=!1,t?s():null!==a.modelProp&&(app.activeModel[a.modelProp]=app.activeModel[a.modelProp]||{},l=app.activeModel[a.modelProp],Object.assign(l,a)),i.renderControl(e,a),a.graphqlQuery?(r=a.url?a.url:app.settings.graphqlUrl,n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:a.graphqlQuery,variables:app.buildGraphQLVariables(a.graphqlQuery,app.activeModel)})}):r=app.buildUrl(a.url,app.activeModel),app.fetch(r,n).then(function(r){if("object"!=typeof r&&null!==r)throw new TypeError("Invalid Response type. Received data in format of ["+typeof r+"]");if(a.isLoading=!1,a.isLoaded=!0,a.hasError=!1,a.errorMessage=null,a.graphqlQuery){if(t?(s(),Object.assign(app.activeVueModel,r)):null===l?Object.assign(a,r.data):(Object.assign(l,a),Object.assign(l,r.data)),r.errors&&r.errors.length)throw 1===r.errors.length&&r.errors[0].message?"[GraphQL Error]: "+r.errors[0].message:a.errorTextGraphQLErrors.replace("{count}",r.errors.length)}else t?(s(),Object.assign(app.activeVueModel,r)):null===l?Object.assign(a,r):(Object.assign(l,a),Object.assign(l,r));i.renderControl(e,a),null!==i.onFetch&&i.onFetch.call(a,e),void 0!==o&&o()}).catch(function(r){a.isLoading=!1,a.isLoaded=!1,a.hasError=!0,a.errorMessage=r,t?s():null!==l&&Object.assign(l,a),i.renderControl(e,a,r),null!==i.onError&&i.onError.call(a,e),void 0!==o&&o()}))},renderControl:function(r,e,o){var a,l;l=e,null!==(a=r).querySelector(".is-loading, is-loaded, .has-error")&&(app.loadCss("dataformsjs-control-json-data",".dataformsjs-control-loading .is-loaded { display:none; } .dataformsjs-control-loading .has-error { display:none; } .dataformsjs-control-loaded .is-loading { display:none; } .dataformsjs-control-loaded .has-error { display:none; } .dataformsjs-control-error .is-loading { display:none; } .dataformsjs-control-error .is-loaded { display:none; }"),a.classList.remove("dataformsjs-control-loading"),a.classList.remove("dataformsjs-control-error"),a.classList.remove("dataformsjs-control-loaded"),l.isLoading?a.classList.add("dataformsjs-control-loading"):l.isLoaded?a.classList.add("dataformsjs-control-loaded"):l.hasError&&a.classList.add("dataformsjs-control-error")),app.activeController&&"Vue"===app.activeController.viewEngine||null!==e.vueInstance?void 0===o?null!==e.vueInstance?e.vueInstance.$nextTick(app.refreshPlugins):app.refreshPlugins():app.showError(r,o):null!==app.activeModel||void 0===window.Vue||null!==e.vueInstance?null!==r.getAttribute("data-template-id")||null!==r.getAttribute("data-template-url")?null===e.modelProp?app.refreshHtmlControl(r,void 0,e):app.refreshHtmlControl(r):void 0===o?app.refreshPlugins(r):app.showError(r,o):e.vueInstance=new Vue({el:r,data:e})},onLoad:function(e){var o=this;this.graphqlId||this.graphqlSrc?(this.url||(this.url=app.settings.graphqlUrl),app.getGraphQL(o.graphqlId,o.graphqlSrc).then(function(r){o.graphqlQuery=r,i.setupControl(o,e)}).catch(function(r){app.showErrorAlert(r),i.setupControl(o,e)})):i.setupControl(o,e)},setupControl:function(r,e){if(null===r.clickSelector)i.fetchData.call(r,e),null!==r.refreshTimeInterval&&(r.intervalID=window.setInterval(function(){i.fetchData.call(r,e)},r.refreshTimeInterval));else{var o=document.querySelector(r.clickSelector);if(null===o){var a="Element not found for <json-data> Control using [data-click-selector]: "+String(r.clickSelector);app.showErrorAlert(a)}else o.addEventListener("click",function(){"boolean"==typeof o.disabled&&(o.disabled=!0),i.fetchData.call(r,e,function(){"boolean"==typeof o.disabled&&(o.disabled=!1)})})}},onUnload:function(){null!==this.intervalID&&window.clearInterval(this.intervalID)}};app.addControl("json-data",i)}();