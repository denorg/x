!function(){"use strict";var f={listSelector:function(){return"[data-edit-list][data-template-id],[data-edit-list][data-template-url]"},setuplistEditorControls:function(){var t=this,e=document.querySelectorAll(f.listSelector());Array.prototype.forEach.call(e,function(e){try{t.setuplistEditorControl(e)}catch(t){app.showError(e,t)}})},setuplistEditorControl:function(n){var t,e,a,l,r,i,o,d,u,s=n.getAttribute("data-edit-list"),c=n.querySelectorAll("[data-list-item]"),p=n.querySelector("[data-add-item]");for(l=0,r=c.length;l<r;l++){for(i=0,o=(t=c[l].querySelectorAll('[name^="item-field-"]')).length;i<o;i++)"INPUT"!==(d=t[i].nodeName)&&"TEXTAREA"!==d&&"SELECT"!==d||(t[i].setAttribute("data-array",s),t[i].setAttribute("data-index",l),u=void 0===t[i].oninput?"change":"input",t[i].addEventListener(u,f.listItemValueChanged));null!==(a=c[l].querySelector("[data-delete-button]"))&&(a.setAttribute("data-array",s),a.setAttribute("data-index",l),a.addEventListener("click",f.listItemDeleteClick),a.style.cursor="pointer")}null!==p&&null!==(e=p.querySelector("[data-add-button]"))&&(e.style.cursor="pointer",e.addEventListener("click",function(){var t,e,a,l,r={},i=p.querySelectorAll('[name^="item-field-"]');for(a=0,l=i.length;a<l;a++)t=i[a].name.substring(11),e=f.getFormFieldValue(i[a]),r[t]=e;app.activeModel[s].push(r),f.reloadListEditorControl(n)})),void 0!==app.events&&"function"==typeof app.events.dispatch&&app.events.dispatch("listEditor.loadedListEditorControl",n)},getFormFieldValue:function(t){var e,a=t.nodeName,l=t.type,r=t.getAttribute("data-type"),i=null;switch(""===(i="INPUT"===a||"SELECT"===a||"TEXTAREA"===a?"checkbox"===l||"radio"===l?t.checked:t.value:t.textContent.trim())&&(i=null),r){case"int":e=parseInt(i,10),isNaN(e)||(i=e);break;case"float":e=parseFloat(i),isNaN(e)||(i=e)}return i},listItemValueChanged:function(t){var e=t.target,a=e.getAttribute("data-array"),l=e.getAttribute("data-index"),r=e.name.substring(11),i=f.getFormFieldValue(e);app.activeModel[a][l][r]=i},listItemDeleteClick:function(t){var e,a=t.target,l=a.getAttribute("data-array"),r=parseInt(a.getAttribute("data-index"),10);for(app.activeModel[l].splice(r,1),e=a.parentNode;null!==e&&null===e.getAttribute("data-edit-list")&&null===e.getAttribute("data-template-url")&&null===e.getAttribute("data-template-id");)e=e.parentNode;f.reloadListEditorControl(e)},reloadListEditorControl:function(t){app.refreshHtmlControl(t,function(){f.setuplistEditorControl(t)})},validate:function(){var r=void 0!==app.validation&&"function"==typeof app.validation.validateInput?app.validation.validateInput:null;if(null===r)return console.warn("[app.plugins.listEditor.validate()] was called, however no validation function exists."),[];var i=[],t=document.querySelectorAll(f.listSelector());return Array.prototype.forEach.call(t,function(t){var a=1,e=t.querySelectorAll("[data-list-item]"),l=t.getAttribute("data-list-label");Array.prototype.forEach.call(e,function(t){var e=t.querySelectorAll('input[name^="item-field-"], select[name^="item-field-"], textarea[name^="item-field-"]');Array.prototype.forEach.call(e,function(t){var e=r(t,null,a,l);e&&i.push(e)}),a++})}),i},onRendered:function(){this.setuplistEditorControls()}};app.addPlugin("listEditor",f)}();