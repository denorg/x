!function(){"use strict";var e=app.deepClone({},app.pages.jsonData);Object.assign(e.model,{newRecord:!1,recordDeleted:!1,fieldSelector:'input[id^="field-"],input[name^="field-"],select[id^="field-"],select[name^="field-"],textarea[id^="field-"],textarea[name^="field-"]',saveButtonSelector:".btn-save",deleteButtonSelector:".btn-delete",infoSelector:".info-message",errorSelector:".error-message",errorListSelector:".error-list",saveUrl:null,deleteUrl:null,useSaveApi:!0,newRecordRedirectUrl:null,updateRecordRedirectUrl:null,deleteRecordRedirectUrl:null,resultSuccessDisplayInterval:2e3,deleteRecordRedirectInterval:1e3,onFormLoaded:null,onFormBeforeSave:null,onFormAfterSave:null,onFormAfterDelete:null,onFormSaveError:null,onFormDeleteError:null,textMessages:{savingRecord:"Saving Record...",deletingRecord:"Deleting Record...",recordSaved:"Record saved at {time}",recordDeleted:"Record deleted at {time}",confirmDelete:"Are you sure that you want to delete this record?"},loadFormFields:function(){var l=this;if(!l.newRecord){var e=document.querySelectorAll(l.fieldSelector);Array.prototype.forEach.call(e,function(e){var t=e.nodeName;if("INPUT"===t||"SELECT"===t||"TEXTAREA"===t){if(null!==e.getAttribute("data-keep-default"))return;var r=0===e.id.indexOf("field-")?e.id:e.name;r=r.replace("field-","");var o=void 0!==l[r]?l[r]:"";"checkbox"===e.type?(o=String(o).toLowerCase(),e.checked="true"===o||"1"===o||"yes"===o||"y"===o):e.value=o}}),void 0!==app.events&&"function"==typeof app.events.dispatch&&app.events.dispatch("entryForm.loadedFormFields")}},setButtonEvents:function(){var e;this.hideInfo(),this.hideError(),""!==this.saveButtonSelector&&null!==(e=document.querySelector(this.saveButtonSelector))&&(this.recordDeleted?(e.style.display="none",e.onclick=null):(e.onclick=this.saveRecord.bind(this),e.disabled&&(e.disabled=!1))),""!==this.deleteButtonSelector&&null!==(e=document.querySelector(this.deleteButtonSelector))&&(this.recordDeleted?(e.style.display="none",e.onclick=null):this.newRecord?e.style.display="none":(e.onclick=this.deleteRecord.bind(this),e.disabled&&(e.disabled=!1)))},updateCssElements:function(){var e=document.querySelectorAll(".hide-after-form-load");Array.prototype.forEach.call(e,function(e){e.style.display="none"}),e=document.querySelectorAll(".show-after-form-load"),Array.prototype.forEach.call(e,function(e){e.style.display=""})},showInfo:function(e,t,r){var o=this,l=document.querySelector(this.infoSelector);null!==l&&(l.textContent=e,l.style.display="",t&&window.setTimeout(function(){l.style.display="none",o.enableButtons(!0),r&&r()},parseInt(t,10)))},hideInfo:function(){var e=document.querySelector(this.infoSelector);null!==e&&(e.style.display="none")},showError:function(e){var t=document.querySelector(this.errorSelector);null!==t?(t.textContent=e,t.style.display=""):app.showErrorAlert(e)},showErrorList:function(e){var t=document.querySelector(this.errorListSelector);if(null!==t&&"UL"===t.nodeName){t.innerHTML="";for(var r=0,o=e.length;r<o;r++){var l=document.createElement("li");l.textContent=e[r],t.appendChild(l)}t.style.display=""}else this.showError(e.join(" "))},hideError:function(){var e=document.querySelector(this.errorSelector);null!==e&&(e.style.display="none"),null!==(e=document.querySelector(this.errorListSelector))&&(e.style.display="none")},enableButtons:function(r){[this.saveButtonSelector,this.deleteButtonSelector].forEach(function(e){var t=document.querySelector(e);null!==t&&(t.disabled=!r)})},getRecord:function(){var n={},i=[],a=void 0!==app.validation&&"function"==typeof app.validation.validateInput?app.validation.validateInput:null,e=document.querySelectorAll(this.fieldSelector);if(Array.prototype.forEach.call(e,function(e){var t=0===e.name.indexOf("field-")?e.name:e.id;t=t.replace("field-","");var r=e.getAttribute("data-value");if(null===r&&(r="checkbox"===e.type?e.checked:e.value),""!==r){var o=e.getAttribute("data-type");"int"===o?(r=parseInt(r,10),isNaN(r)&&(r=null)):"float"===o&&(r=parseFloat(r),isNaN(r)&&(r=null))}if(""===r&&(r=null),a){var l=a(e,t);l&&i.push(l)}n[t]=r}),void 0!==app.plugins.listEditor&&"function"==typeof app.plugins.listEditor.listSelector&&"function"==typeof app.plugins.listEditor.validate){a&&(i=i.concat(app.plugins.listEditor.validate()));var t=app.plugins.listEditor.listSelector(),r=document.querySelectorAll(t);Array.prototype.forEach.call(r,function(e){var t=e.getAttribute("data-edit-list");null!==t&&void 0!==app.activeModel[t]&&Array.isArray(app.activeModel[t])&&(n[t]=app.activeModel[t])})}return{record:n,errors:i}},saveRecord:function(e){var a=this;e&&e.preventDefault&&e.preventDefault();var t=a.getRecord(),r=t.record;if(0!==Object.keys(r).length)if(null!==a.saveUrl&&""!==a.saveUrl){if(0<t.errors.length)a.showErrorList(t.errors);else if("function"!=typeof a.onFormBeforeSave||a.onFormBeforeSave(r)){Object.assign(a,r),a.enableButtons(!1),a.hideError(),a.showInfo(a.textMessages.savingRecord);var o=app.buildUrl(a.saveUrl);app.fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(function(t){var r=!1;if(!a.useSaveApi||t.success){a.newRecord&&(r=!0),a.newRecord=!1;var e=a.useSaveApi?t.fields:t;if(void 0!==e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(a[o]=e[o]);a.loadFormFields(),a.setButtonEvents(),app.refreshAllHtmlControls(),app.loadAllJsControls()}var l="string"==typeof t.result?t.result:a.textMessages.recordSaved,n=new Date;n=n.toLocaleTimeString?n.toLocaleTimeString():n.toTimeString(),l=l.replace(/{time}/g,n),a.showInfo(l,a.resultSuccessDisplayInterval,function(){var e=r?a.newRecordRedirectUrl:a.updateRecordRedirectUrl;if(null!==e){if(app.activeModel!==a)return;void 0!==t.fields&&(app.activeParameterList=t.fields),0===(e=app.buildUrl(e)).indexOf("#")?window.location.hash=e:window.location=e}}),"function"==typeof a.onFormAfterSave&&a.onFormAfterSave()}else{a.setButtonEvents();var i=void 0===t.errorMessage?null:t.errorMessage;null===i&&a.useSaveApi&&void 0===t.success&&(i='Error - Save/Submit Web Service did not return the expected [success] property. If not using the standard entry form API use either [data-use-save-api="false"] or [model.useSaveApi = false].'),a.showError(i)}}).catch(function(e){a.setButtonEvents(),a.showError(e),"function"==typeof a.onFormSaveError&&a.onFormSaveError(e)})}}else a.showError("Error - Unable to save. The property [entryForm.saveUrl] or [data-save-url] is not defined.");else a.showError("Error - Unable to save. No fields were found on the page.")},deleteRecord:function(e){var o=this;if(e&&e.preventDefault&&e.preventDefault(),null!==o.deleteUrl&&""!==o.deleteUrl){var t=app.buildUrl(o.deleteUrl),r=null;if(t===o.deleteRecord){if(r=o.getRecord().record,0===Object.keys(r).length)return void o.showError("Error - Unable to delete. No fields were found on the page.");r=JSON.stringify(r)}o.textMessages.confirmDelete&&!confirm(o.textMessages.confirmDelete)||(o.enableButtons(!1),o.hideError(),o.showInfo(o.textMessages.deletingRecord),app.fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:r}).then(function(t){if(t.success){o.recordDeleted=!0,o.setButtonEvents();var e="string"==typeof t.result?t.result:o.textMessages.recordDeleted,r=new Date;r=r.toLocaleTimeString?r.toLocaleTimeString():r.toTimeString(),e=e.replace(/{time}/g,r),o.showInfo(e),"function"==typeof o.onFormAfterDelete&&o.onFormAfterDelete(),null!==o.deleteRecordRedirectUrl&&window.setTimeout(function(){if(app.activeModel===o){void 0!==t.fields&&(app.activeParameterList=t.fields);var e=app.buildUrl(o.deleteRecordRedirectUrl);0===e.indexOf("#")?window.location.hash=e:window.location=e}},o.deleteRecordRedirectInterval)}else o.setButtonEvents(),o.showError(void 0===t.errorMessage?null:t.errorMessage)}).catch(function(e){o.setButtonEvents(),o.showError(e),"function"==typeof o.onFormDeleteError&&o.onFormDeleteError(e)}))}else o.showError("Error - Unable to save. The property [entryForm.deleteUrl] or [data-delete-url] is not defined.")},setupView:function(){this.loadFormFields(),this.setButtonEvents(),this.updateCssElements(),"function"==typeof this.onFormLoaded&&this.onFormLoaded()}}),e.onRouteLoad=function(){if(this.newRecord&&!this.url)return this.isLoaded=!0,this.hasError=!1,void this.setViewClass("loaded");app.pages.jsonData.onRouteLoad.call(this)},e.onRendered=function(){this.isLoaded&&this.setupView()},app.addPage("entryForm",e)}();