!function(){"use strict";var e={model:{url:"",submittedFetchUrl:"",submittedFetchParams:"",isLoading:!1,isLoaded:!1,hasError:!1,errorMessage:null,prop:null,loadOnlyOnce:!1,errorTextMissingUrl:"Error, unable to fetch data. No URL [data-route | model.url | graphql] was specified for this current route.",errorTextFetchError:"An error has occurred loading the data. Please refresh the page to try again and if the problem continues contact support.",errorTextGraphQLErrors:"{count} GraphQL Errors occured. See [app.activeModel.errors] in console for full details.",fetchTimeStart:null,fetchTimeComplete:null,loadCount:0,errorCount:0,onFetch:null,onError:null,graphqlQuery:null,graphqlId:null,graphqlSrc:null,fetchTimeInMilliseconds:function(){return null!==this.fetchTimeStart&&null!==this.fetchTimeComplete&&this.fetchTimeStart.getTime&&this.fetchTimeComplete.getTime?this.fetchTimeComplete.getTime()-this.fetchTimeStart.getTime():-1},fetchData:function(){var r=this;if(!r.url)return r.isLoading=!1,r.isLoaded=!1,r.hasError=!0,r.errorMessage=r.errorTextMissingUrl,r.setViewClass("error"),void(0===r.loadCount&&0===r.errorCount||app.updateView());r.isLoading=!0,r.setViewClass("loading"),r.fetchTimeStart=new Date,r.fetchTimeComplete=null,r.submittedFetchUrl=r.graphqlQuery?r.url:app.buildUrl(r.url),this.submittedFetchParams=JSON.stringify(app.activeParameterList);var e=null;r.graphqlQuery&&("file://"===window.location.origin||"null"===window.location.origin?(r.submittedFetchUrl+=-1===r.submittedFetchUrl.indexOf("?")?"?":"&",r.submittedFetchUrl+="query="+encodeURIComponent(r.graphqlQuery.trim()),r.submittedFetchUrl+="&variables="+encodeURIComponent(JSON.stringify(app.buildGraphQLVariables(r.graphqlQuery,app.activeParameterList)))):e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:r.graphqlQuery,variables:app.buildGraphQLVariables(r.graphqlQuery,app.activeParameterList)})}),app.fetch(r.submittedFetchUrl,e).then(function(e){if("object"!=typeof e&&null!==e)throw new TypeError("Invalid Response type. Received data in format of ["+typeof e+"]");r.fetchTimeComplete=new Date,r.loadCount++,r.isLoading=!1,r.isLoaded=!0,r.hasError=!1,r.errorMessage=null,r.setViewClass("loaded"),r.graphqlQuery?("string"==typeof r.prop?(r[r.prop]=e.data,e.errors&&(r[r.prop].errors=e.errors)):(Object.assign(r,e.data),e.errors&&(r.errors=e.errors)),e.errors&&e.errors.length&&(1===e.errors.length&&e.errors[0].message?r.errorMessage="[GraphQL Error]: "+e.errors[0].message:r.errorMessage=r.errorTextGraphQLErrors.replace("{count}",e.errors.length),r.hasError=!0,r.setViewClass("error"),"function"==typeof r.onError&&r.onError())):"string"==typeof r.prop?r[r.prop]=e:Object.assign(r,e),"function"==typeof r.onFetch&&r.onFetch(e),app.updateView()}).catch(function(){r.fetchTimeComplete=new Date,r.errorCount++,r.isLoading=!1,r.isLoaded=!1,r.hasError=!0,r.errorMessage=r.errorTextFetchError,r.setViewClass("error"),"function"==typeof r.onError&&r.onError(),app.updateView()})},setViewClass:function(e){if("Text"===app.activeController.viewEngine){var r=document.querySelector(app.settings.viewSelector);null!==r&&(app.loadCss("dataformsjs-view-jsondata",".dataformsjs-view-loading .is-loaded { display:none; } .dataformsjs-view-loading .has-error { display:none; } .dataformsjs-view-loaded .is-loading { display:none; } .dataformsjs-view-loaded .has-error { display:none; } .dataformsjs-view-error .is-loading { display:none; } .dataformsjs-view-error .is-loaded { display:none; }"),r.classList.remove("dataformsjs-view-loading"),r.classList.remove("dataformsjs-view-error"),r.classList.remove("dataformsjs-view-loaded"),null!==e&&r.classList.add("dataformsjs-view-"+e))}},unloadView:function(){this.setViewClass(null)}},onRouteLoad:function(){if(this.loadOnlyOnce&&this.submittedFetchUrl===app.buildUrl(this.url)&&this.submittedFetchParams===JSON.stringify(app.activeParameterList)||(this.isLoaded=!1,this.hasError=!1),this.isLoaded)this.setViewClass("loaded");else if(this.graphqlId||this.graphqlSrc){this.url||(this.url=app.settings.graphqlUrl);var r=this;app.getGraphQL(r.graphqlId,r.graphqlSrc).then(function(e){r.graphqlQuery=e,r.fetchData()}).catch(function(e){app.showErrorAlert(e),r.fetchData()})}else this.fetchData()},onRouteUnload:function(){this.unloadView()}};app.addPage("jsonData",e)}();